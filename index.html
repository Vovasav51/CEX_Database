<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<title>Переглядач біржових відповідей</title>
</head>
<body>
<h1>Переглядач біржових відповідей</h1>
<div>
    <button id="db-load">База: Завантажити</button>
    <button id="db-save">База: Зберегти</button>
</div>
<table id="data-table" border="1">
    <thead>
        <tr>
            <th>Дата</th><th>Біржа</th><th>Блокчейн</th><th>Актив</th>
            <th>Сума</th><th>Напрямок</th><th>Від</th><th>До</th><th>Хеш</th><th>Файл</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
let rows = [];

function renderTable() {
    const tbody = document.querySelector('#data-table tbody');
    tbody.innerHTML = '';
    rows.forEach(r => {
        const tr = document.createElement('tr');
        Object.values(r).forEach(val => {
            const td = document.createElement('td');
            td.textContent = val || '';
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

async function loadFromDb(){
    const r = await fetch('/api/fetch');
    const j = await r.json();
    rows = j.data || [];
    renderTable();
    alert('✅ Дані завантажені');
}

async function saveToDb(){
    if (!rows.length) return alert('Немає даних');
    const r = await fetch('/api/upload', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ rows })
    });
    const j = await r.json();
    alert('✅ Записано: ' + j.inserted);
}

document.getElementById('db-load').addEventListener('click', loadFromDb);
document.getElementById('db-save').addEventListener('click', saveToDb);
</script>
</body>
</html>
